USE [SPA_SQL]
GO

SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Daniele, Salvigni>
-- Create date: <@2018>
-- Description:	<Create UID>
-- =============================================
CREATE TRIGGER [dbo].[CREATE_UPDATE_HASH_PO_Item_ETL]
   ON  [dbo].[PO_Item_ETL] 
   INSTEAD OF INSERT
AS 
BEGIN
	SET NOCOUNT ON;
		INSERT [dbo].[PO_Item_ETL](
		[EKPO_SYSID],
		[EKPO_MANDT],
		[EKPO_BUKRS],
		[EKPO_EBELN],
		[EKPO_EBELP],
		[EKPO_WERKS],
		[EKPO_LOEKZ],
		[EKPO_PSTYP],
		[EKPO_UDATE],
		[EKPO_ORDERDATE],
		[EKPO_MENGE],
		[EKPO_MEINS],
		[EKPO_NETWR],
		[EKPO_CAMOUNT],
		[EKPO_EURAMOUNT],
		[EKPO_WKURS],
		[EKPO_RATE],
		[EKPO_LONGTEXT],
		[EKPO_TXZ01],
		[EKPO_MATKL],
		[EKPO_MATNR],
		[EKPO_REVLV],
		[EKPO_IDNLF],
		[EKPO_BANFN],
		[EKPO_BNFPO],
		[EKPO_AFNAM],
		[EKPO_BEDNR],
		[EKPO_KONNR],
		[EKPO_KTPNR],
		[EKPO_WEPOS],
		[EKPO_EVERS],
		[EKPO_INSMK],
		[EKPO_MHDRZ],
		[EKPO_IPRKZ],
		[EKPO_SSQSS],
		[EKPO_PLIFZ],
		[EKPO_WEBAZ],
		[EKPO_LEWED],
		[EKPO_ABLAD],
		[EKPO_LGORT],
		[EKPO_NAME1],
		[EKPO_NAME2],
		[EKPO_STREET],
		[EKPO_POST_CODE1],
		[EKPO_CITY1],
		[EKPO_REGION],
		[EKPO_COUNTRY],
		[EKPO_PO_BOX],
		[EKPO_KZABS],
		[EKPO_LABNR],
		[EKPO_ELIKZ],
		[EKPO_EREKZ],
		[EKPO_UEBTO],
		[EKPO_UEBTK],
		[EKPO_UNTTO],
		[EKPO_XOBLR],
		[EKPO_KNTTP],
		[EKPO_VRTKZ],
		[EKPO_INCO1],
		[EKPO_INCO2],
		[EKPO_MFRNR],
		[EKPO_MFRPN],
		[EKPO_EAN11],
		[EKPO_ERUSERNAME],
		[EKPO_AEUSERNAME],
		[EKPO_AEDAT],
		[EKPO_DATUM],
		[EKPO_ZZBP1],
		[EKPO_ZZCR1],
		[EKPO_ZZPT1],
		[EKPO_ZZPD1],
		[EKPO_ZZBP2],
		[EKPO_ZZCR2],
		[EKPO_ZZPT2],
		[EKPO_ZZPD2],
		[EKPO_ZZBP3],
		[EKPO_ZZCR3],
		[EKPO_ZZPT3],
		[EKPO_ZZPD3],
		[EKPO_ZZBP4],
		[EKPO_ZZCR4],
		[EKPO_ZZPT4],
		[EKPO_ZZPD4],
		[EKPO_ZZBP5],
		[EKPO_ZZCR5],
		[EKPO_ZZPT5],
		[EKPO_ZZPD5],
		[EKPO_WAERS],
		[EKPO_ADRNR],
		[EKPO_ADRN2],
		[HASH_PO_ITEM],
		[HASH_PO_HEADER],
		[HASH_PR]
		)
			SELECT
				i.[EKPO_SYSID],
				i.[EKPO_MANDT],
				[dbo].[add_0](4,REPLACE(i.[EKPO_BUKRS],'"','')),
				[dbo].[add_0](10,REPLACE(i.[EKPO_EBELN],'"','')),
				[dbo].[add_0](5,REPLACE(i.[EKPO_EBELP],'"','')),
				i.[EKPO_WERKS],
				i.[EKPO_LOEKZ],
				i.[EKPO_PSTYP],
				i.[EKPO_UDATE],
				i.[EKPO_ORDERDATE],
				i.[EKPO_MENGE],
				i.[EKPO_MEINS],
				i.[EKPO_NETWR],
				i.[EKPO_CAMOUNT],
				i.[EKPO_EURAMOUNT],
				i.[EKPO_WKURS],
				i.[EKPO_RATE],
				i.[EKPO_LONGTEXT],
				i.[EKPO_TXZ01],
				i.[EKPO_MATKL],
				i.[EKPO_MATNR],
				i.[EKPO_REVLV],
				i.[EKPO_IDNLF],
				i.[EKPO_BANFN],
				[dbo].[add_0](5,REPLACE(i.[EKPO_BNFPO],'"','')),
				i.[EKPO_AFNAM],
				i.[EKPO_BEDNR],
				[dbo].[add_0](10,REPLACE(i.[EKPO_KONNR],'"','')),
				[dbo].[add_0](5,REPLACE(i.[EKPO_KTPNR],'"','')),
				i.[EKPO_WEPOS],
				i.[EKPO_EVERS],
				i.[EKPO_INSMK],
				i.[EKPO_MHDRZ],
				i.[EKPO_IPRKZ],
				i.[EKPO_SSQSS],
				i.[EKPO_PLIFZ],	
				i.[EKPO_WEBAZ],
				i.[EKPO_LEWED],
				i.[EKPO_ABLAD],
				i.[EKPO_LGORT],
				i.[EKPO_NAME1],
				i.[EKPO_NAME2],
				i.[EKPO_STREET],
				i.[EKPO_POST_CODE1],
				i.[EKPO_CITY1],
				i.[EKPO_REGION],
				i.[EKPO_COUNTRY],
				i.[EKPO_PO_BOX],
				i.[EKPO_KZABS],
				i.[EKPO_LABNR],
				i.[EKPO_ELIKZ],
				i.[EKPO_EREKZ],
				i.[EKPO_UEBTO],
				i.[EKPO_UEBTK],
				i.[EKPO_UNTTO],
				i.[EKPO_XOBLR],
				i.[EKPO_KNTTP],
				i.[EKPO_VRTKZ],
				i.[EKPO_INCO1],
				i.[EKPO_INCO2],
				i.[EKPO_MFRNR],
				i.[EKPO_MFRPN],
				i.[EKPO_EAN11],
				i.[EKPO_ERUSERNAME],
				i.[EKPO_AEUSERNAME],
				i.[EKPO_AEDAT],
				i.[EKPO_DATUM],
				i.[EKPO_ZZBP1],
				i.[EKPO_ZZCR1],
				i.[EKPO_ZZPT1],
				i.[EKPO_ZZPD1],
				i.[EKPO_ZZBP2],
				i.[EKPO_ZZCR2],
				i.[EKPO_ZZPT2],
				i.[EKPO_ZZPD2],
				i.[EKPO_ZZBP3],
				i.[EKPO_ZZCR3],
				i.[EKPO_ZZPT3],
				i.[EKPO_ZZPD3],
				i.[EKPO_ZZBP4],
				i.[EKPO_ZZCR4],
				i.[EKPO_ZZPT4],
				i.[EKPO_ZZPD4],
				i.[EKPO_ZZBP5],
				i.[EKPO_ZZCR5],
				i.[EKPO_ZZPT5],
				i.[EKPO_ZZPD5],
				i.[EKPO_WAERS],
				i.[EKPO_ADRNR],
				i.[EKPO_ADRN2],
				HASHBYTES('MD5',CONCAT(REPLACE(REPLACE(i.[EKPO_SYSID],'"',''),' ',''),REPLACE(REPLACE(i.[EKPO_MANDT],'"',''),' ',''),REPLACE([dbo].[add_0](10,REPLACE(i.[EKPO_EBELN],'"','')),' ',''),REPLACE([dbo].[add_0](5,REPLACE(i.[EKPO_EBELP],'"','')),' ',''))) as [HASH_PO_ITEM],
				HASHBYTES('MD5',CONCAT(REPLACE(REPLACE(i.[EKPO_SYSID],'"',''),' ',''),REPLACE(REPLACE(i.[EKPO_MANDT],'"',''),' ',''),REPLACE([dbo].[add_0](10,REPLACE(i.[EKPO_EBELN],'"','')),' ',''))) as [HASH_PO_HEADER],
				HASHBYTES('MD5',CONCAT(REPLACE(REPLACE(i.[EKPO_SYSID],'"',''),' ',''),REPLACE(REPLACE(i.[EKPO_MANDT],'"',''),' ',''),REPLACE([dbo].[rem_0](REPLACE(i.[EKPO_BANFN],'"','')),' ',''),REPLACE([dbo].[add_0](5,REPLACE(i.[EKPO_BNFPO],'"','')),' ',''))) as [HASH_PR]		
			FROM
			inserted as i;
END


